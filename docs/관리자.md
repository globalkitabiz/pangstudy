# 관리자 메뉴 및 기능 설명서

**최종 업데이트:** 2025-12-21

이 문서는 Pangstudy의 관리자 기능과 UI에 대한 한국어 설명서입니다. 관리자 권한을 가진 사용자는 사용자 관리, 과제(Assignments) 할당, 운영 리포트 확인 등의 작업을 할 수 있습니다.

---

## 관리자 메뉴 구조

### 라우팅 (App.js)

| 경로 | 컴포넌트 | 설명 |
|------|----------|------|
| `/admin` | ManageUsers | 관리자 메인 페이지 |
| `/users` | → `/admin` 리다이렉트 | 이전 버전 호환 |
| `/study/assigned` | StudySession (assignedMode) | 할당된 학습 |
| `/recommendations` | Recommendations | 추천 학습 |

---

## 관리자 페이지 (ManageUsers)

### 위치
- URL: `/admin`
- 파일: `client/src/components/ManageUsers.js`

### 화면 구성

```
+----------------------------------+
|  Users                           |
+----------------------------------+
|  사용자1 email@example.com       |
|  [View Decks] [Assign]           |
|  --------------------------------|
|  사용자2 user2@example.com       |
|  [View Decks] [Assign]           |
+----------------------------------+
|  [사용자 추가 폼]                |
+----------------------------------+
|  Week 1 Report                   |
|  (week1_completion.md 내용)      |
+----------------------------------+
```

### 기능

1. **사용자 목록 보기**
   - API: `GET /api/users`
   - 모든 사용자 이름, 이메일 표시

2. **View Decks 버튼**
   - `/users/{userId}/decks`로 이동
   - 해당 사용자의 덱 목록 보기

3. **Assign 버튼**
   - AssignModal 모달 열기
   - 사용자에게 덱 또는 카드 할당

4. **사용자 추가 (AddUserForm)**
   - 이름, 이메일, 비밀번호 입력
   - API: `POST /api/users`

5. **Admin Report**
   - `week1_completion.md` 파일 내용 표시

---

## 할당 모달 (AssignModal)

### 위치
- 파일: `client/src/components/AssignModal.js`

### 입력 필드

| 필드 | 설명 | 필수 |
|------|------|------|
| User ID | 할당 대상 사용자 ID (자동 채움) | O |
| Deck | 덱 선택 드롭다운 | - |
| Card | 카드 선택 (덱 선택 시 활성화) | - |
| Due date | 기한 (YYYY-MM-DD HH:MM:SS) | - |
| Repeat days | 반복 간격 (일 단위) | - |
| Notes | 관리자 메모 | - |

### 동작
- 덱 선택 시 해당 덱의 카드 목록 로드
- Card를 비워두면 덱 전체 할당
- API: `POST /api/admin/assign`

---

## 관리자 API

### 1. 할당 생성

```
POST /api/admin/assign
```

**요청 헤더:**
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```

**요청 본문:**
```json
{
  "user_id": 1,
  "deck_id": 2,
  "card_id": null,
  "due_date": "2025-12-25 09:00:00",
  "repeat_interval_days": 7,
  "notes": "매주 복습"
}
```

**응답:**
```json
{
  "success": true,
  "assignmentId": 123
}
```

**권한:** 관리자만 (`is_admin = 1`)

### 2. 할당된 학습 목록 조회

```
GET /api/study/assigned/due
```

**응답:**
```json
{
  "assignments": [
    {
      "id": 1,
      "user_id": 1,
      "deck_id": 2,
      "card_id": null,
      "due_date": "2025-12-21 09:00:00",
      "status": "assigned",
      "deck_name": "영어 단어",
      "card_front": null,
      "card_back": null
    }
  ]
}
```

### 3. 할당 리뷰 완료

```
POST /api/study/assigned/{id}/review
```

**동작:**
- `repeat_interval_days > 0`: 다음 기한 설정
- `repeat_interval_days = 0`: 상태를 `completed`로 변경

---

## 데이터베이스 스키마

### assignments 테이블

```sql
CREATE TABLE assignments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  card_id INTEGER,
  deck_id INTEGER,
  assigned_by INTEGER NOT NULL,
  due_date TEXT,
  repeat_interval_days INTEGER DEFAULT 0,
  notes TEXT,
  status TEXT DEFAULT 'assigned',
  created_at TEXT DEFAULT (DATETIME('now'))
);
```

### users 테이블 (is_admin 컬럼)

```sql
ALTER TABLE users ADD COLUMN is_admin INTEGER DEFAULT 0;
```

---

## 관리자 권한 설정

### 방법 1: D1 콘솔에서 직접 설정

```sql
-- 특정 사용자를 관리자로 설정
UPDATE users SET is_admin = 1 WHERE email = 'admin@example.com';

-- 관리자 권한 확인
SELECT id, email, is_admin FROM users;
```

### 방법 2: Wrangler CLI 사용

```bash
npx wrangler d1 execute pangstudy-db --remote \
  --command="UPDATE users SET is_admin = 1 WHERE email = 'admin@example.com'"
```

---

## 할당 학습 모드 (사용자 측)

### 접근 방법
- URL: `/study/assigned`
- StudySession 컴포넌트에서 `assignedMode={true}` 활성화

### 동작
1. `GET /api/study/assigned/due`로 기한이 된 할당 목록 조회
2. 카드별 또는 덱별 학습 진행
3. 리뷰 완료 시 `POST /api/study/assigned/{id}/review` 호출
4. 반복 간격 설정 시 자동으로 다음 기한 설정

---

## 추천 학습 (Recommendations)

### 위치
- URL: `/recommendations`
- 파일: `client/src/components/Recommendations.js`

### API
```
GET /api/recommendations?userId={userId}
```

### A/B 테스트 가중치 (wrangler.toml)
```toml
REC_WEIGHT_DUE = "5"
REC_WEIGHT_ASSIGNED = "10"
REC_WEIGHT_RECENT = "1"
REC_WEIGHT_WRONG = "8"
```

---

## 운영 체크리스트

- [ ] 관리자 계정 생성 후 `is_admin=1` 설정
- [ ] assignments 마이그레이션 실행 (`0005_assignments.sql`)
- [ ] is_admin 컬럼 마이그레이션 실행 (`0006_add_is_admin.sql`)
- [ ] 대량 할당 필요 시 서버 측 스크립트로 여러 assignments 행 추가

---

## 향후 개선 제안

1. **AssignModal 개선**
   - 사용자 검색/선택 드롭다운 추가
   - 날짜 선택기(datepicker) UI 개선

2. **알림 기능**
   - 할당 시 이메일 또는 웹훅 알림 전송

3. **관리자 대시보드**
   - 할당 목록 페이지 (필터/페이징/검색)
   - 사용자별 학습 통계

4. **권한 관리 UI**
   - 관리자 페이지에서 사용자 권한 설정

---

## 테스트 계정

로컬 테스트용 예시:
- 이메일: `test@example.com`
- 비밀번호: `test123`

관리자 권한 부여:
```sql
UPDATE users SET is_admin = 1 WHERE email = 'test@example.com';
```

---

## 파일 구조

```
client/src/components/
├── ManageUsers.js       # 관리자 메인 페이지
├── AssignModal.js       # 할당 모달
├── AdminReport.js       # 주간 리포트 표시
├── AddUserForm.js       # 사용자 추가 폼
└── Recommendations.js   # 추천 학습

functions/api/
├── admin/
│   └── assign.js        # POST /api/admin/assign
├── study/
│   └── assigned/
│       ├── due.js       # GET /api/study/assigned/due
│       └── [id]/
│           └── review.js # POST /api/study/assigned/:id/review
├── analytics.js         # A/B 테스트 이벤트 수집
├── analytics_stats.js   # A/B 테스트 통계 조회
└── recommendations.js   # 추천 API

migrations/
├── 0005_assignments.sql # assignments 테이블
└── 0006_add_is_admin.sql # is_admin 컬럼
```

---

문의 및 추가 요청은 개발 담당자에게 요청해주세요.
